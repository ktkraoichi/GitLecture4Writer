# 文章に関わる全ての人のための Git & GitHub 入門 1-2「コミットを積み上げる」

この連載はこんな人に向けて書かれています。

- 小説作家さん
- 編集者さん
- 校正さん
- ライターさん
- 発注者さん

要するに、文章を扱う全ての人々です。

## 1. 今回のゴール

1. GitHub にプライベートリポジトリを作ってクローンする
2. ローカルリポジトリにコミットを積み上げる
3. プライベートリポジトリにローカルリポジトリの内容をプッシュする

以上です。ここまでできれば、あなたはとてもとてもスゴい。

どんどんローカルリポジトリにコミットしていきましょう。\
あのときに戻りたくなったらいつでも戻れるようにしましょう。

プライベートリポジトリにプッシュしておけば PC が爆発しても大丈夫。\
卒論とか修論とかを書いているそこのあなた、いまからでも遅くないですよ。\
いやマジでマジで。

## 2. `fetch` と `pull` をしてみよう

いきなり今回のゴールから逸れますが、前回の記事で `clone` した「GitLecture4Writer」のローカルリポジトリを更新してみましょう。

fixme: 以降の章を書いてから `fetch` と `pull` をしてもらう。\
fixme: 狙いは「こんな感じになることを目指そうな」という遠いゴールを示すこと。

最終的に、皆さんがこのような樹形図を作り、内容を理解できるようになることが、この記事の目標です。

安心してください、片倉はひととおり覚えるまでに4ヶ月かかりました。\
早い人は1ヶ月かからないでしょうが、学ぶペースは人それぞれです。\
ゆっくりとやっていきましょう。

## 3. GitHub にプライベートリポジトリを作ってクローンする

それでは本題のゴールへ向かいましょう。

これから作成するプライベートリポジトリは、**あなただけ**がアクセスできるリポジトリです。\
外部の誰かに見られることはありません。安心して使ってください。\
ただし、いったんパブリック（公開設定）にするとプライベートには戻せません。注意してくださいね。

まず、プライベートリポジトリにどんなファイルを置くか決めましょう。\
Git を利用した管理に向くのは、何度も変更がかかるテキストデータです。

書きかけの原稿がある？　**それです**。それを置くことにしましょう。書きかけの原稿は Git で管理したいテキストデータ第一位です。

特に決まっていない？　では、試しに議事録を置いてみてはどうでしょうか。議事録を回覧すると「そういう意図じゃない」ということで元の内容から変更がかかることがあります。誰の意図で変更がかかったのか、コミットメッセージに残しておくと責任の所在を明確にできます。

プライベートリポジトリに置くものが決まったら、 [GitHub のトップページ](https://github.com/)にアクセスしましょう。

![GitHubTop](img/Cap1_2-1_GitHubTop.png)
「Repositories」のすぐ隣にある「**New**」をクリックします。

新しいリポジトリの作成画面が表示されます。

![CreateNewRepo](img/Cap1_2-2_CreateNewRepo.png)

- Repository name\
  適切なリポジトリ名を入力してください。
- Description\
  簡単な説明を入れておくと「何のリポジトリだっけ」を防げます。
- Public or Private\
  **Private にしてください**。デフォルトでは Public になっています。
- Initialize this repository with a README\
  チェックを入れてください。「クローンして使うならここにチェック入れてね」と書いてあります。

もういちど入力内容をチェックしてください。\
大丈夫そうなら **Create repository** ボタンをクリックしてください。

じきにこんな画面が出てきます。

![CreatedRepo](img/Cap1_2-3_CreatedRepo.png)

それではこのリモートリポジトリをローカルリポジトリにクローンしましょう。\
ブラウザはそのままにしておいてくださいね。

### 3.1. Sourcetree で操作する人

Sourcetree を起動してください。

CLI で操作する人は以下まで飛んでください。\
[3.2. CLI で操作する人](###-32-cli-で操作する人)

Sourcetree では新しいタブを作成します。\
下図の「＋」ボタンをクリックしてください。

![SourceTreeNewTab](img/Cap1_2-4_SourcetreeNewTab.png)

新しいリポジトリを登録する画面が出てきます。\
Clone ボタンをクリックすると、見覚えのある画面になります。

![SourceTreeClone](img/Cap1_2-5_SourcetreeClone.png)

「元のパス/URL:」の欄に、先ほど作成したプライベートリポジトリの URL を貼りつけます。\
ブラウザに切り替えて、先ほど作成した GitHub のプライベートリポジトリのページに行きましょう。

![GitHubCloneURL](img/Cap1_2-6_GitHubCloneURL.png)

緑色のボタン、 **Clone or download** をクリックすると、プライベートリポジトリのURLが表示されます。\
**Clone with HTTPS** になっていることを確認してください。\
もし **Clone with SSH** になっていたら、 Use HTTPS と書かれたリンクをクリックしてください。

青色でハイライトされた文字列がプライベートリポジトリの URL です。\
クリップボードにコピーするボタンをクリックするか、ハイライトを選択して `Ctrl + C` でクリップボードにコピーしてください。

![SoucetreePasteURL](img/Cap1_2-7_SourcetreePasteURL.png)

「元のパス/URL:」の欄に、コピーしたプライベートリポジトリの URL を貼りつけます。\
適当に欄外をクリックすると Sourcetree がぐるぐる動き始め…

![GitHubOATH1](img/Cap1_2-8_GitHubOATH1.png)

GitHub の認証画面が出てきます。\
※環境によって画面の細部が違う可能性があります。片倉は Windows10 Pro 64bit と Google Chrome を使用しています。

GitHub に登録したユーザー名とパスワードを入力しましょう。\
プライベートリポジトリへアクセスするためには、 GitHub アカウントの認証を通す必要があります。

![GitHubOATH2](img/Cap1_2-9_GitHubOATH2.png)

2要素認証を設定している人は、ワンタイムパスワードを入力する画面も出てきます。2要素認証、設定しましょうね。

無事に認証が通るとこんな画面になります。

![SourcetreeReadyClone](img/Cap1_2-10_SourcetreeReadyClone.png)

「クローン」ボタンを押しましょう。

無事にクローンが完了すると、こんな画面になります。

![SourcetreeCloned1](img/Cap1_2-11_SourcetreeCloned1.png)

クローンしたばかりでファイルを編集したりしていないので、なにもありません。

左側のカラムにある「History」をクリックすると、こんな画面になります。

![SourcetreeCloned2](img/Cap1_2-12_SourcetreeCloned2.png)

**Initial commit** （最初のコミット）があることを確認できましたか？\
右下の README.md の内容は、リモートリポジトリにある README の内容と一致していますか？

無事に一致していたなら、おめでとうございます！\
これでリモートリポジトリとローカルリポジトリを繋ぐことができました。

前回、リモートリポジトリは「ローカルのデータを転送し、複数人で共有できる場所」と説明しました。\
一人で運用する場合、リモートリポジトリは「オンライン上にローカルのバックアップを作成する場所」と考えてください。\
ローカルでヤベー操作をしても、お使いのパソコンが爆発しても、リモートリポジトリが残っていれば大丈夫。もういちどクローンすれば元通りになります。

それでは次の\
[4. ローカルリポジトリにコミットを積み上げる](##-4-ローカルリポジトリにコミットを積み上げる)\
まで飛びましょう。

### 3.2. CLI で操作する人

GitBash かターミナルを起動して、リポジトリをクローンするフォルダへ移動してください。\
前回と同様、 Documents フォルダに作成するなら以下のコマンドです。

`cd Documents`

移動したら、ブラウザに切り替えて先ほど作成した GitHub のプライベートリポジトリのページに行きましょう。

![GitHubCloneURL](img/Cap1_2-6_GitHubCloneURL.png)

緑色のボタン、 **Clone or download** をクリックすると、プライベートリポジトリのURLが表示されます。\
**Clone with HTTPS** になっていることを確認してください。\
もし **Clone with SSH** になっていたら、 Use HTTPS と書かれたリンクをクリックしてください。

青色でハイライトされた文字列がプライベートリポジトリの URL です。\
クリップボードにコピーするボタンをクリックするか、ハイライトを選択して `Ctrl + C` でクリップボードにコピーしてください。

以下のコマンドでクローンします。

`git clone "さっきコピーしたURL"`

例： `git clone https://github.com/ktkraoichi/SSSprints.git`

クローン作業が始まり…

![GitHubOATH1](img/Cap1_2-8_GitHubOATH1.png)

GitHub の認証画面が出てきます。\
※環境によって画面の細部が違う可能性があります。片倉は Windows10 Pro 64bit と Google Chrome を使用しています。

GitHub に登録したユーザー名とパスワードを入力しましょう。\
プライベートリポジトリへアクセスするためには、 GitHub アカウントの認証を通す必要があります。

![GitHubOATH2](img/Cap1_2-9_GitHubOATH2.png)

2要素認証を設定している人は、ワンタイムパスワードを入力する画面も出てきます。2要素認証、設定しましょうね。

無事に認証が通ると、ターミナルの表示はこんな感じになります。

```bash
Ktkr@KtkrPC MINGW64 ~
$ cd Documents

Ktkr@KtkrPC MINGW64 ~/Documents
$ git clone https://github.com/ktkraoichi/SSSprints.git
Cloning into 'SSSprints'...
remote: Enumerating objects: 3, done.
remote: Counting objects: 100% (3/3), done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (3/3), done.

Ktkr@KtkrPC MINGW64 ~/Documents
$
```

クローンしたリポジトリに移動して、内容を確認しましょう。

```bash
Ktkr@KtkrPC MINGW64 ~/Documents
$ cd SSSprints

Ktkr@KtkrPC MINGW64 ~/Documents/SSSprints (master)
$ ls -a
.  ..  .git  README.md

Ktkr@KtkrPC MINGW64 ~/Documents/SSSprints (master)
$
```

`vim README.md`

と入力して、 README.md の内容がリモートリポジトリの内容と一致していることを確認してみましょう。\
※ vim は GitBash や Mac OS X に標準でインストールされているテキストエディタです。

```vim
# SSSprints
即興(S)小説(S)スプリントのリポジトリ
~
~
~
~
~
~
~
~
~
~
~
~
~
README.md [unix] (16:09 15/02/2020)                                                                                                         1,1 全て
"README.md" [unix] 2L, 64C
```

こんな感じです。

確認できたら `:q` と入力して vim を終了しましょう。\
※ vim の詳細な使い方についてはググってください。この連載では最低限の操作だけ記述します。

無事にクローンできたなら、素晴らしい！\
これでリモートリポジトリとローカルリポジトリを繋ぐことができました。

前回、リモートリポジトリは「ローカルのデータを転送し、複数人で共有できる場所」と説明しました。\
一人で運用する場合、リモートリポジトリは「オンライン上にローカルのバックアップを作成する場所」と考えてください。\
ローカルでヤベー操作をしても、お使いのパソコンが爆発しても、リモートリポジトリが残っていれば大丈夫。もういちどクローンすれば元通りになります。

それでは次の\
[4. ローカルリポジトリにコミットを積み上げる](##-4-ローカルリポジトリにコミットを積み上げる)\
に進みましょう！

ちなみに。\
お気づきかもしれませんが、 CLI を使った Git の操作は、 GUI に比べるとステップ数がめちゃくちゃ少なくて済みます。

## 4. ローカルリポジトリにコミットを積み上げる

fixme: コミット≒セーブデータの作成（`git commit`）について概説します

### 4.1 実際にコミットを作ろう

それでは、あなたの手でコミットを作成しましょう。

…と言いたいところなのですが、まず確認したいことがひとつ。\
いま、あなたの手元にある原稿ファイルは、テキストファイルですか？\
もし .docx や .rtf や .jtd や .indd や .pages なら、それらは全てバイナリファイルです。プレーンテキストファイル（.txt）に変換しましょう。

Git は中身がテキストであるファイル（テキストファイル）を扱うのに向いています。\
中身がテキストではないファイル（バイナリファイル）を扱うのは苦手です。\
例えば、この記事の本体はテキストファイルですが、画像はバイナリファイルです。この記事本体の差分は Git で確認できますが、画像の差分は確認できません。

見出しやリストが必要なら、マークダウン記法（.md）で記述するのがオススメです。\
マークダウン記法とは、手軽に文章を装飾できる書き方です。\
参考：[Markdown記法 &middot; 日本語Markdownユーザー会](https://www.markdown.jp/syntax/)

日本語の小説でよく使われる、ルビ、圏点、縦中横といった書式を扱いたいなら、マークダウン記法を拡張した「でんでんマークダウン」をオススメします。\
[電書ちゃんのでんでんマークダウン - でんでんマークダウン](https://conv.denshochan.com/markdown)

テキストデータを準備したら、クローンしたリポジトリに放り込みましょう。

### 4.2 いつコミットすればいいのか（コミット粒度）

fixme: コミット粒度については詳しめに解説します

fixme: --amend オプションも解説していいかも（Sourcetree にあれば）

## 5. プライベートリポジトリにローカルリポジトリの内容をプッシュする

fixme: プッシュ（`git push`）について書きます

fixme: https だと `push` のたびに GitHub 認証を通す必要があります。何度も認証を通すのは面倒なので、 SSH について多めに紙幅を割きます。

fixme: SSH についてはざっくり「鍵穴（公開鍵）」と「鍵（秘密鍵）」という感じで説明します。鍵を見せたり無くしたりするのは絶対ダメですよ、ということも含めます。RSAで作成して、長さは4096にしておけばいいでしょう。Sourcetree のSSH鍵管理ツールが 2048 だとダメって言ってた気がします。長さがダメなのかRSAがダメなのかは検証します。

fixme: 当分はいい感じのところでコミットしてリモートにぽいぽいするだけで十分ということを書きましょう

## 6. 次回予告

fixme: やれる方針が3つくらいあるので、どうしようか悩み中

1. GitHub で簡単な校正校閲をする
   1. issue に原稿へのパーマリンクを貼って議論する、という形が無難か
   2. Contributor の設定とかにも言及する
   3. もちろん Pull request で議論するほうが良いが、まだブランチの説明をしていないので無理
2. `restore`, `rebase` など、履歴の活用について解説する
   1. master にひたすら積む間も、この2つのコマンドは使うことが多いだろう
   2. いずれにせよ Sourcetree で使える機能に絞る（Sourcetree のヘビーユーザーにちょっと話を聞かせてもらう？）
   3. `stash` はブランチを切り替えるときの一時退避として使うイメージ、そもそも多用するコマンドではないと考える
   4. とりあえず `commit` しておいて、後で `rebase` したほうがいい
3. 既存のフォルダを Git 管理下に置いてリモートに投げる、というのもアリ？
   1. つまり `git init` です
   2. `git init` するなら `git config` にも触れたいよね
   3. Sourcetree ならローカルフォルダを指定するだけで勝手に色々やってくれそう（やったことがない）

## 7. 付録

fixme: 何かネタがあったら書いておきましょう

fixme: `git status` は手癖にしなさい、という話とか（とても大事）

## 監修

@acple@github

- C#チョットデキル
- Git完全に理解している
